#!/bin/bash
# blog - Create a new hugo post and open in vim

PROJECT_ROOT="$HOME/ws/bodell-io"

new_post() {
    cd "$PROJECT_ROOT"

    SLUG="$1"
    DATE="${2:-$(date +%Y-%m)}"

    YEAR=$(echo "$DATE" | cut -d'-' -f1)
    MONTH=$(echo "$DATE" | cut -d'-' -f2)

    DIR="content/posts/$YEAR/$MONTH"
    FILEPATH="$DIR/$SLUG.md"

    if [ ! -d "$DIR" ]; then
        mkdir -p "$DIR"
    fi

    if [ ! -f "$FILEPATH" ]; then
        hugo new "$FILEPATH"
    else
        echo "$FILEPATH already exists"
    fi

    vim + "$FILEPATH"
}

publish() {
    cd "$PROJECT_ROOT"
    ./deploy.sh -p
}

if [ ! -e "$PROJECT_ROOT" ]; then
    echo "make sure that blog root is in $PROJECT_ROOT"
    exit 1
fi

if [ -z "$1" ]; then
    echo "Usage: blog [<dashed-title> [YYYY-MM]] | publish]"
    exit 1
fi

if [[ "$1" == "publish" ]]; then
    publish
    exit 0
fi

new_post "$1" "$2"
